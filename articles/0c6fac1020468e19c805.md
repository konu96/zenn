---
title: "Nuxt.js ã§ useContext ã‚’ä½¿ã£ãŸæ™‚ã®ãƒ¢ãƒƒã‚¯æ–¹æ³•"
emoji: "ğŸ‘»"
type: "tech"
topics: ["Nuxt.js", "Jest", "Test"]
published: true
---

# æ¦‚è¦
Nuxt.js ã§ `useContext` ã‚’ä½¿ã£ãŸæ™‚ã®ãƒ†ã‚¹ãƒˆã§èº“ã„ãŸã®ã§å¿˜ã‚Œãªã„ã‚ˆã†ã«ãƒ¡ãƒ¢

ä»Šå›ã¯ã€[`@nuxtjs/dayjs`](https://github.com/nuxt-community/dayjs-module) ã® `useContext` ã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã€‚
ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¯ `isToday` é–¢æ•°ã§ã‚ã‚‹ã€‚

```typescript
//useDayjs.ts
export const useDayjs = () => {
  const { $dayjs } = useContext()

  const isToday = (date: ConfigType): boolean => {
      // use $dayjs
  }

  return {
    isToday
  }
}
```

```typescript
// index.vue
export default defineComponent({
  setup() {
    const { isToday } = useDayjs()

    return {
      isToday
    }
  }
})
```

## `useContext` ã‹ã‚‰å–å¾—ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¢ãƒƒã‚¯æ–¹æ³•

Composition API ã‚’ä½¿ã‚ãªã„æ›¸ãæ–¹ã ã¨ã€ [mocks](https://vue-test-utils.vuejs.org/ja/api/options.html#mocks) ã§ `$dayjs` ã‚’ãƒ¢ãƒƒã‚¯ã§ãã‚‹ã€‚

```javascript
const wrapper = shallowMount(Component, {
  mocks: {
    $dayjs: dayjs
  }
})
```

ãŸã ã€Composition API ã ã¨åŒã˜ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã§ã€ `useContext` ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¢ãƒƒã‚¯ã§ããŸã€‚

```javascript
const wrapper = shallowMount(Component, {
  mocks: {
    $nuxt: {
      context: {
        $dayjs: dayjs
      },
    },
  },
})
```

`Date.now` ã‚’å›ºå®šã™ã‚‹ã¨ãã¯ã€ [Jest ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://jestjs.io/ja/docs/snapshot-testing#%EF%BC%92%EF%BC%8E-%E3%81%B9%E3%81%8D%E7%AD%89%E6%80%A7%E3%81%AE%E3%81%82%E3%82%8B%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8D%E3%81%BE%E3%81%97%E3%82%87%E3%81%86) ã«ã‚‚æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€`jest.fn` ã‚’ä½¿ãˆã°ç°¡å˜ã«ã§ãã‚‹ã€‚
ãŸã ã€æ•°å€¤ã‚’æŒ‡å®šã™ã‚‹ã®ã§ç›´æ„Ÿçš„ã«æ—¥ä»˜ã®ç†è§£ãŒé›£ã—ã„ã€‚ [mockDate](https://www.npmjs.com/package/mockdate) ã‚’ä½¿ãˆã°ã€åˆ†ã‹ã‚Šã‚„ã™ãç°¡å˜ã«ã€€`Date` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¢ãƒƒã‚¯ã§ãã‚‹ã€‚
